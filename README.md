# BuildStory.Agents

**Autonomous AI agents for real-time landing page optimization**

BuildStory.Agents is a Next.js application where autonomous AI agents generate, test, and optimize landing pages in real-time using multi-armed bandits and persona-based targeting.

## 🎯 What It Does

- **Persona Classification**: Automatically detects if visitors are developers, investors, or end users
- **Dynamic Content Generation**: AI agents create and optimize sections based on visitor persona
- **Multi-Armed Bandit Testing**: Thompson sampling automatically finds best-performing variants
- **Real-Time Adaptation**: Pages adapt instantly based on visitor behavior and conversion data
- **Brand Consistency**: Brand guardian ensures tone and style consistency across all variants

## 🏗️ Architecture

### Agents
- **PersonaAgent**: Fast persona classification based on UTM params, referrer, device type
- **SectionAgent**: Generates optimized content for each section type (hero, problem, solution, etc.)
- **BrandGuardian**: Validates content against brand guidelines and tone
- **Strategist**: Uses Thompson sampling to choose optimal variants
- **DataStoryteller**: Converts user events into social proof and testimonials

### Multi-Armed Bandit
- Thompson sampling for variant selection
- Beta distribution for conversion rate estimation
- Automatic reward tracking and parameter updates
- Per-section, per-persona optimization

### Tech Stack
- **Framework**: Next.js 14 with App Router
- **Database**: Supabase (PostgreSQL)
- **Caching**: Redis/Upstash (optional)
- **AI**: OpenAI GPT-4 for content generation
- **Animation**: Framer Motion
- **Styling**: Tailwind CSS
- **Types**: TypeScript with Zod validation

## 🚀 Quick Start

### 1. Prerequisites
- Node.js 18+ and Bun
- Supabase account
- OpenAI API key

### 2. Installation
```bash
git clone <your-repo>
cd buildstory-agents
bun install
```

### 3. Database Setup
1. Create a new Supabase project
2. Run the SQL from `database/schema.sql` in your Supabase SQL editor
3. Copy your Supabase URL and anon key

### 4. Environment Configuration
```bash
cp .env.example .env.local
```

Fill in your environment variables:
```env
OPENAI_API_KEY=sk-your-openai-key-here
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key
```

### 5. Run Development Server
```bash
bun dev
```

Visit `http://localhost:3000` to see the application.

## 📝 Usage

### Creating a Story
1. Fill out the product brief (describe your product in 2-3 sentences)
2. Set brand name and tone (professional, friendly, authoritative, conversational)
3. Choose primary color
4. Click "Generate Landing Page"

### Viewing Generated Landing Page
- Visit `/s/[storyId]` to see your generated landing page
- The page adapts based on your detected persona (dev/investor/user)
- Use the persona bar in the top-right to manually switch personas
- All interactions are tracked for optimization

### Real-Time Optimization
- Each section has multiple variants generated by AI agents
- The strategist uses Thompson sampling to show the best-performing variant
- Conversion events (CTA clicks) update the bandit parameters
- Pages improve automatically as more visitors interact

## 🏛️ Database Schema

### Tables
- `stories`: Basic story information and brand settings
- `storyboards`: Generated landing page versions per persona
- `bandit_state`: Multi-armed bandit parameters (alpha, beta) per variant
- `events`: User interaction tracking (views, clicks, scrolls, etc.)

### Key Relationships
- Stories have multiple storyboards (one per persona)
- Each section can have multiple variants tracked in bandit_state
- All user interactions are logged as events for analysis

## 🔧 API Endpoints

### POST /api/story
Create a new story with AI-generated content
```json
{
  "brief": "Product description",
  "tone": "professional",
  "brandName": "Your Brand",
  "palette": ["#3b82f6", "#1e40af", "#64748b"]
}
```

### POST /api/rewrite
Optimize a specific section
```json
{
  "storyId": "uuid",
  "sectionKey": "hero",
  "goal": "conversion",
  "optimize": true
}
```

### POST /api/track
Track user events
```json
{
  "storyId": "uuid",
  "sectionKey": "hero",
  "variantHash": "abc123",
  "event": "ctaClick",
  "meta": {"ctaIndex": 0}
}
```

### GET /s/[storyId]
Server-side rendered landing page with agent optimizations

## 🎨 Section Types

### Hero
- Headline, subheading, CTA buttons
- Demo idea suggestion

### Bullets (Problem)
- List of pain points
- Visual bullet points with icons

### Steps (Solution)
- Numbered workflow steps
- Sequential flow design

### Quotes (Social Proof)
- Customer testimonials
- Role/company attribution

### Tiers (Pricing)
- Pricing plans with features
- Popular tier highlighting

### QnA (FAQ)
- Expandable question/answer pairs
- Common objections addressed

## 🧠 AI Prompts

The system uses carefully crafted prompts for different agents:

- **Planner**: Creates complete storyboards from brief + persona
- **Rewriter**: Optimizes individual sections for specific goals
- **Brand Guardian**: Ensures consistency with brand guidelines

Prompts include persona targeting, tone enforcement, and structural constraints.

## 📊 Analytics & Optimization

### Event Tracking
- Page views and dwell time
- Scroll depth and engagement
- CTA clicks and conversions
- Persona polling and switching

### Bandit Metrics
- Conversion rates per variant
- Confidence intervals
- Total trials and regret
- Performance dashboards (coming soon)

### Real-Time Updates
- Thompson sampling for variant selection
- Automatic parameter updates on conversions
- Live adaptation to visitor behavior

## 🔒 Security & Guidelines

### Content Safety
- PII detection and blocking
- Profanity filtering
- Unverifiable claims prevention
- Brand guideline enforcement

### Rate Limiting
- API endpoints protected
- Per-IP request limits
- Graceful degradation

## 🚀 Deployment

### Vercel (Recommended)
1. Connect your GitHub repository
2. Add environment variables in Vercel dashboard
3. Deploy automatically on push

### Other Platforms
- Ensure Node.js 18+ support
- Configure environment variables
- Set up database connection

## 📈 Performance

### Optimization Strategies
- Edge runtime for fast response times
- ISR with 60-second revalidation
- Efficient database queries with indexes
- Client-side caching for repeated requests

### Monitoring
- Real-time conversion tracking
- Bandit performance metrics
- Error monitoring and alerts
- Performance analytics

## 🛠️ Development

### Project Structure
```
src/
├── app/                   # Next.js App Router
│   ├── (site)/s/[id]/    # Dynamic story pages
│   ├── api/              # API endpoints
│   └── page.tsx          # Home page
├── components/           # UI components
│   └── sections/         # Landing page sections
├── lib/                  # Core utilities
│   ├── agents/          # AI agents
│   ├── storyboard.ts    # Types and validation
│   ├── database.ts      # Database operations
│   ├── bandit.ts        # Multi-armed bandit
│   └── tracking.ts      # Event tracking
└── database/            # SQL schema
```

### Adding New Agents
1. Create agent file in `lib/agents/`
2. Implement the `propose(context, section)` interface
3. Add to strategist workflow
4. Update API endpoints as needed

### Adding New Section Types
1. Add type to Zod schema in `storyboard.ts`
2. Create React component in `components/sections/`
3. Update section rendering logic
4. Add agent prompts for the new type

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## 📄 License

MIT License - see LICENSE file for details

## 🆘 Troubleshooting

### Common Issues
- **Database connection**: Check Supabase URL and key
- **LLM generation**: Verify OpenAI API key and quotas
- **Persona detection**: May need manual override via URL params
- **Bandit convergence**: Requires sufficient traffic for optimization

### Debug Mode
Set `NODE_ENV=development` for verbose logging and error details.

---

**BuildStory.Agents** - Where AI meets conversion optimization 🚀
